(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pay"],{"712a":function(e,t,a){"use strict";a("c370")},"86c1":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"pay"},[a("div",{directives:[{name:"show",rawName:"v-show",value:1===e.wcpayType,expression:"wcpayType === 1"}],staticClass:"pay-title"},[e._m(0)]),a("div",{directives:[{name:"show",rawName:"v-show",value:1!==e.wcpayType,expression:"wcpayType !== 1"}]},[a("div",{staticClass:"loading-indicator loading-error"},[e._v("支付失败")])]),e.payCount?a("div",[a("div",{staticClass:"loading-indicator loading-error"},[e._v("第"+e._s(e.payCount)+"次查询支付结果"),a("span")])]):e._e(),1!==e.wcpayType?a("van-button",{attrs:{type:"primary"},on:{click:e.refresh}},[e._v("再次支付")]):e._e()],1)},r=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"loading-indicator"},[e._v("支付订单创建成功,请支付"),a("span")])}],o=(a("d3b7"),a("4d63"),a("ac1f"),a("25f0"),a("466d"),a("5319"),a("841c"),a("1276"),a("96cf"),a("1da1")),i={data:function(){return{code:"",money:"",wcpayType:1,payCount:0,prepayData:{},token:"",href:"https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxc54755f1f5042a10&redirect_uri=https%3a%2f%2fplay.yiyuanmaidian.com%2f%23%2fpay&response_type=code&scope=snsapi_base&state="}},methods:{refresh:function(){window.location.replace(this.href+this.money+"&token="+this.token)},GetQueryString:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(t);return null!=a?unescape(a[2]):null},payIsSuccess:function(){var e=this;return new Promise((function(t){e.payCount%5&&t(!0),e.$dialog.confirm({title:"提醒",cancelButtonText:"继续",confirmButtonText:"返回",message:"检测到已经连续".concat(e.payCount,"次查询结果都没有支付成功！你可以先返回！联系客服！")}).then((function(){t(!1)})).catch((function(){t(!0)}))}))},payQuery:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$post("h5Pay/query?out_trade_no=".concat(e.prepayData.out_trade_no),{},!0);case 2:if(a=t.sent,0!==a.data.errno){t.next=7;break}return localStorage.setItem("pay",!0),e.$dialog.alert({title:"成功",message:"支付成功,点击返回！",confirmButtonColor:"#07c160"}).then((function(){e.$router.go(-1)})),t.abrupt("return");case 7:return e.payCount=e.payCount+1,t.next=10,e.payIsSuccess();case 10:if(n=t.sent,!n){t.next=15;break}return e.$toast("第".concat(e.payCount,"次查询支付...")),setTimeout((function(){e.payQuery()}),2e3),t.abrupt("return");case 15:e.$router.go(-1);case 16:case"end":return t.stop()}}),t)})))()},pay:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$get("h5Pay/prepay",{code:e.code,actualPrice:e.money},!0);case 2:a=t.sent,n=a.data,e.prepayData=n,WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:n.appId,timeStamp:n.timeStamp,nonceStr:n.nonceStr,package:n.package,signType:n.signType,paySign:n.paySign},(function(t){"get_brand_wcpay_request:ok"==t.err_msg?(e.payQuery(),e.wcpayType=1):"get_brand_wcpay_request:cancel"==t.err_msg?(e.wcpayType=2,e.$toast("支付取消")):"get_brand_wcpay_request:fail"==t.err_msg&&(e.payQuery(),e.wcpayType=3,e.$toast("支付失败"),WeixinJSBridge.call("closeWindow"))}));case 6:case"end":return t.stop()}}),t)})))()}},mounted:function(){var e=this;this.code=this.GetQueryString("code");var t=this.GetQueryString("state").split("isToken");this.money=t[0],this.token=t[1],localStorage.setItem("token",this.token),this.$nextTick((function(){e.pay()}))}},c=i,s=(a("712a"),a("2877")),p=Object(s["a"])(c,n,r,!1,null,"039e2370",null);t["default"]=p.exports},c370:function(e,t,a){}}]);